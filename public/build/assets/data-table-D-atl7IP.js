const Oe=i=>Object.prototype.toString.call(i)==="[object Object]",be=(i,e)=>{const t=document.createElement(i);if(e&&typeof e=="object")for(const s in e)s==="html"?t.innerHTML=e[s]:t.setAttribute(s,e[s]);return t},ie=i=>["#text","#comment"].includes(i.nodeName)?i.data:i.childNodes?i.childNodes.map(e=>ie(e)).join(""):"",ve=function(i,e){let t=0,s=0;for(;t<i+1;)e[s].hidden||(t+=1),s+=1;return s-1};function he(i,e,t){var s;return i.nodeName==="#text"?s=t.document.createTextNode(i.data):i.nodeName==="#comment"?s=t.document.createComment(i.data):(e?s=t.document.createElementNS("http://www.w3.org/2000/svg",i.nodeName):i.nodeName.toLowerCase()==="svg"?(s=t.document.createElementNS("http://www.w3.org/2000/svg","svg"),e=!0):s=t.document.createElement(i.nodeName),i.attributes&&Object.entries(i.attributes).forEach(function(n){var o=n[0],a=n[1];return s.setAttribute(o,a)}),i.childNodes&&i.childNodes.forEach(function(n){return s.appendChild(he(n,e,t))}),t.valueDiffing&&(i.value&&(s instanceof HTMLButtonElement||s instanceof HTMLDataElement||s instanceof HTMLInputElement||s instanceof HTMLLIElement||s instanceof HTMLMeterElement||s instanceof HTMLOptionElement||s instanceof HTMLProgressElement||s instanceof HTMLParamElement)&&(s.value=i.value),i.checked&&s instanceof HTMLInputElement&&(s.checked=i.checked),i.selected&&s instanceof HTMLOptionElement&&(s.selected=i.selected))),s}var le=function(i,e){for(e=e.slice();e.length>0;){var t=e.splice(0,1)[0];i=i.childNodes[t]}return i};function q(i,e,t){var s,n,o,a=e[t._const.action],l=e[t._const.route];[t._const.addElement,t._const.addTextElement].includes(a)||(s=le(i,l));var r={diff:e,node:s};if(t.preDiffApply(r))return!0;switch(a){case t._const.addAttribute:if(!(s&&s instanceof Element))return!1;s.setAttribute(e[t._const.name],e[t._const.value]);break;case t._const.modifyAttribute:if(!(s&&s instanceof Element))return!1;s.setAttribute(e[t._const.name],e[t._const.newValue]),s instanceof HTMLInputElement&&e[t._const.name]==="value"&&(s.value=e[t._const.newValue]);break;case t._const.removeAttribute:if(!(s&&s instanceof Element))return!1;s.removeAttribute(e[t._const.name]);break;case t._const.modifyTextElement:if(!(s&&s instanceof Text))return!1;t.textDiff(s,s.data,e[t._const.oldValue],e[t._const.newValue]),s.parentNode instanceof HTMLTextAreaElement&&(s.parentNode.value=e[t._const.newValue]);break;case t._const.modifyValue:if(!s||s.value===void 0)return!1;s.value=e[t._const.newValue];break;case t._const.modifyComment:if(!(s&&s instanceof Comment))return!1;t.textDiff(s,s.data,e[t._const.oldValue],e[t._const.newValue]);break;case t._const.modifyChecked:if(!s||s.checked===void 0)return!1;s.checked=e[t._const.newValue];break;case t._const.modifySelected:if(!s||s.selected===void 0)return!1;s.selected=e[t._const.newValue];break;case t._const.replaceElement:var d=e[t._const.newValue].nodeName.toLowerCase()==="svg"||s.parentNode.namespaceURI==="http://www.w3.org/2000/svg";s.parentNode.replaceChild(he(e[t._const.newValue],d,t),s);break;case t._const.relocateGroup:Array.apply(void 0,new Array(e[t._const.groupLength])).map(function(){return s.removeChild(s.childNodes[e[t._const.from]])}).forEach(function(u,h){h===0&&(o=s.childNodes[e[t._const.to]]),s.insertBefore(u,o||null)});break;case t._const.removeElement:s.parentNode.removeChild(s);break;case t._const.addElement:var g=(f=l.slice()).splice(f.length-1,1)[0];if(!((s=le(i,f))instanceof Element))return!1;s.insertBefore(he(e[t._const.element],s.namespaceURI==="http://www.w3.org/2000/svg",t),s.childNodes[g]||null);break;case t._const.removeTextElement:if(!s||s.nodeType!==3)return!1;var _=s.parentNode;_.removeChild(s),_ instanceof HTMLTextAreaElement&&(_.value="");break;case t._const.addTextElement:var f;if(g=(f=l.slice()).splice(f.length-1,1)[0],n=t.document.createTextNode(e[t._const.value]),!(s=le(i,f)).childNodes)return!1;s.insertBefore(n,s.childNodes[g]||null),s.parentNode instanceof HTMLTextAreaElement&&(s.parentNode.value=e[t._const.value]);break;default:console.log("unknown action")}return t.postDiffApply({diff:r.diff,node:r.node,newNode:n}),!0}function de(i,e,t){var s=i[e];i[e]=i[t],i[t]=s}function $e(i,e,t){(e=e.slice()).reverse(),e.forEach(function(s){(function(n,o,a){switch(o[a._const.action]){case a._const.addAttribute:o[a._const.action]=a._const.removeAttribute,q(n,o,a);break;case a._const.modifyAttribute:de(o,a._const.oldValue,a._const.newValue),q(n,o,a);break;case a._const.removeAttribute:o[a._const.action]=a._const.addAttribute,q(n,o,a);break;case a._const.modifyTextElement:case a._const.modifyValue:case a._const.modifyComment:case a._const.modifyChecked:case a._const.modifySelected:case a._const.replaceElement:de(o,a._const.oldValue,a._const.newValue),q(n,o,a);break;case a._const.relocateGroup:de(o,a._const.from,a._const.to),q(n,o,a);break;case a._const.removeElement:o[a._const.action]=a._const.addElement,q(n,o,a);break;case a._const.addElement:o[a._const.action]=a._const.removeElement,q(n,o,a);break;case a._const.removeTextElement:o[a._const.action]=a._const.addTextElement,q(n,o,a);break;case a._const.addTextElement:o[a._const.action]=a._const.removeTextElement,q(n,o,a);break;default:console.log("unknown action")}})(i,s,t)})}var ue=function(i){var e=[];return e.push(i.nodeName),i.nodeName!=="#text"&&i.nodeName!=="#comment"&&i.attributes&&(i.attributes.class&&e.push("".concat(i.nodeName,".").concat(i.attributes.class.replace(/ /g,"."))),i.attributes.id&&e.push("".concat(i.nodeName,"#").concat(i.attributes.id))),e},ye=function(i){var e={},t={};return i.forEach(function(s){ue(s).forEach(function(n){var o=n in e;o||n in t?o&&(delete e[n],t[n]=!0):e[n]=!0})}),e},xe=function(i,e){var t=ye(i),s=ye(e),n={};return Object.keys(t).forEach(function(o){s[o]&&(n[o]=!0)}),n},Me=function(i){return delete i.outerDone,delete i.innerDone,delete i.valueDone,!i.childNodes||i.childNodes.every(Me)},R=function(i){if(Object.prototype.hasOwnProperty.call(i,"data"))return{nodeName:i.nodeName==="#text"?"#text":"#comment",data:i.data};var e={nodeName:i.nodeName};return Object.prototype.hasOwnProperty.call(i,"attributes")&&(e.attributes=i.attributes),Object.prototype.hasOwnProperty.call(i,"checked")&&(e.checked=i.checked),Object.prototype.hasOwnProperty.call(i,"value")&&(e.value=i.value),Object.prototype.hasOwnProperty.call(i,"selected")&&(e.selected=i.selected),Object.prototype.hasOwnProperty.call(i,"childNodes")&&(e.childNodes=i.childNodes.map(function(t){return R(t)})),e},pe=function(i,e){if(!["nodeName","value","checked","selected","data"].every(function(n){return i[n]===e[n]}))return!1;if(Object.prototype.hasOwnProperty.call(i,"data"))return!0;if(!!i.attributes!=!!e.attributes||!!i.childNodes!=!!e.childNodes)return!1;if(i.attributes){var t=Object.keys(i.attributes),s=Object.keys(e.attributes);if(t.length!==s.length||!t.every(function(n){return i.attributes[n]===e.attributes[n]}))return!1}return!(i.childNodes&&(i.childNodes.length!==e.childNodes.length||!i.childNodes.every(function(n,o){return pe(n,e.childNodes[o])})))},_e=function(i,e,t,s,n){if(n===void 0&&(n=!1),!i||!e||i.nodeName!==e.nodeName)return!1;if(["#text","#comment"].includes(i.nodeName))return!!n||i.data===e.data;if(i.nodeName in t)return!0;if(i.attributes&&e.attributes){if(i.attributes.id){if(i.attributes.id!==e.attributes.id)return!1;if("".concat(i.nodeName,"#").concat(i.attributes.id)in t)return!0}if(i.attributes.class&&i.attributes.class===e.attributes.class&&"".concat(i.nodeName,".").concat(i.attributes.class.replace(/ /g,"."))in t)return!0}if(s)return!0;var o=i.childNodes?i.childNodes.slice().reverse():[],a=e.childNodes?e.childNodes.slice().reverse():[];if(o.length!==a.length)return!1;if(n)return o.every(function(r,d){return r.nodeName===a[d].nodeName});var l=xe(o,a);return o.every(function(r,d){return _e(r,a[d],l,!0,!0)})},ne=function(i,e){return Array.apply(void 0,new Array(i)).map(function(){return e})},Te=function(i,e){for(var t=i.childNodes?i.childNodes:[],s=e.childNodes?e.childNodes:[],n=ne(t.length,!1),o=ne(s.length,!1),a=[],l=function(){return arguments[1]},r=!1,d=function(){var g=function(_,f,u,h){var v=0,w=[],y=_.length,c=f.length,V=Array.apply(void 0,new Array(y+1)).map(function(){return[]}),$=xe(_,f),T=y===c;T&&_.some(function(A,D){var m=ue(A),p=ue(f[D]);return m.length!==p.length?(T=!1,!0):(m.some(function(M,b){if(M!==p[b])return T=!1,!0}),!T||void 0)});for(var S=0;S<y;S++)for(var O=_[S],N=0;N<c;N++){var P=f[N];u[S]||h[N]||!_e(O,P,$,T)?V[S+1][N+1]=0:(V[S+1][N+1]=V[S][N]?V[S][N]+1:1,V[S+1][N+1]>=v&&(v=V[S+1][N+1],w=[S+1,N+1]))}return v!==0&&{oldValue:w[0]-v,newValue:w[1]-v,length:v}}(t,s,n,o);g?(a.push(g),Array.apply(void 0,new Array(g.length)).map(l).forEach(function(_){return function(f,u,h,v){f[h.oldValue+v]=!0,u[h.newValue+v]=!0}(n,o,g,_)})):r=!0};!r;)d();return i.subsets=a,i.subsetsAge=100,a},Se=function(){function i(){this.list=[]}return i.prototype.add=function(e){var t;(t=this.list).push.apply(t,e)},i.prototype.forEach=function(e){this.list.forEach(function(t){return e(t)})},i}(),H=function(){function i(e){e===void 0&&(e={});var t=this;Object.entries(e).forEach(function(s){var n=s[0],o=s[1];return t[n]=o})}return i.prototype.toString=function(){return JSON.stringify(this)},i.prototype.setValue=function(e,t){return this[e]=t,this},i}();function ce(i,e){var t,s,n=i;for(e=e.slice();e.length>0;)s=e.splice(0,1)[0],t=n,n=n.childNodes?n.childNodes[s]:void 0;return{node:n,parentNode:t,nodeIndex:s}}function Le(i,e,t){return e.forEach(function(s){(function(n,o,a){var l,r,d,g;if(![a._const.addElement,a._const.addTextElement].includes(o[a._const.action])){var _=ce(n,o[a._const.route]);r=_.node,d=_.parentNode,g=_.nodeIndex}var f,u,h=[],v={diff:o,node:r};if(a.preVirtualDiffApply(v))return!0;switch(o[a._const.action]){case a._const.addAttribute:r.attributes||(r.attributes={}),r.attributes[o[a._const.name]]=o[a._const.value],o[a._const.name]==="checked"?r.checked=!0:o[a._const.name]==="selected"?r.selected=!0:r.nodeName==="INPUT"&&o[a._const.name]==="value"&&(r.value=o[a._const.value]);break;case a._const.modifyAttribute:r.attributes[o[a._const.name]]=o[a._const.newValue];break;case a._const.removeAttribute:delete r.attributes[o[a._const.name]],Object.keys(r.attributes).length===0&&delete r.attributes,o[a._const.name]==="checked"?r.checked=!1:o[a._const.name]==="selected"?delete r.selected:r.nodeName==="INPUT"&&o[a._const.name]==="value"&&delete r.value;break;case a._const.modifyTextElement:r.data=o[a._const.newValue],d.nodeName==="TEXTAREA"&&(d.value=o[a._const.newValue]);break;case a._const.modifyValue:r.value=o[a._const.newValue];break;case a._const.modifyComment:r.data=o[a._const.newValue];break;case a._const.modifyChecked:r.checked=o[a._const.newValue];break;case a._const.modifySelected:r.selected=o[a._const.newValue];break;case a._const.replaceElement:f=o[a._const.newValue],d.childNodes[g]=f;break;case a._const.relocateGroup:r.childNodes.splice(o[a._const.from],o[a._const.groupLength]).reverse().forEach(function(c){return r.childNodes.splice(o[a._const.to],0,c)}),r.subsets&&r.subsets.forEach(function(c){if(o[a._const.from]<o[a._const.to]&&c.oldValue<=o[a._const.to]&&c.oldValue>o[a._const.from])c.oldValue-=o[a._const.groupLength],(V=c.oldValue+c.length-o[a._const.to])>0&&(h.push({oldValue:o[a._const.to]+o[a._const.groupLength],newValue:c.newValue+c.length-V,length:V}),c.length-=V);else if(o[a._const.from]>o[a._const.to]&&c.oldValue>o[a._const.to]&&c.oldValue<o[a._const.from]){var V;c.oldValue+=o[a._const.groupLength],(V=c.oldValue+c.length-o[a._const.to])>0&&(h.push({oldValue:o[a._const.to]+o[a._const.groupLength],newValue:c.newValue+c.length-V,length:V}),c.length-=V)}else c.oldValue===o[a._const.from]&&(c.oldValue=o[a._const.to])});break;case a._const.removeElement:d.childNodes.splice(g,1),d.subsets&&d.subsets.forEach(function(c){c.oldValue>g?c.oldValue-=1:c.oldValue===g?c.delete=!0:c.oldValue<g&&c.oldValue+c.length>g&&(c.oldValue+c.length-1===g?c.length--:(h.push({newValue:c.newValue+g-c.oldValue,oldValue:g,length:c.length-g+c.oldValue-1}),c.length=g-c.oldValue))}),r=d;break;case a._const.addElement:var w=(u=o[a._const.route].slice()).splice(u.length-1,1)[0];r=(l=ce(n,u))===null||l===void 0?void 0:l.node,f=o[a._const.element],r.childNodes||(r.childNodes=[]),w>=r.childNodes.length?r.childNodes.push(f):r.childNodes.splice(w,0,f),r.subsets&&r.subsets.forEach(function(c){if(c.oldValue>=w)c.oldValue+=1;else if(c.oldValue<w&&c.oldValue+c.length>w){var V=c.oldValue+c.length-w;h.push({newValue:c.newValue+c.length-V,oldValue:w+1,length:V}),c.length-=V}});break;case a._const.removeTextElement:d.childNodes.splice(g,1),d.nodeName==="TEXTAREA"&&delete d.value,d.subsets&&d.subsets.forEach(function(c){c.oldValue>g?c.oldValue-=1:c.oldValue===g?c.delete=!0:c.oldValue<g&&c.oldValue+c.length>g&&(c.oldValue+c.length-1===g?c.length--:(h.push({newValue:c.newValue+g-c.oldValue,oldValue:g,length:c.length-g+c.oldValue-1}),c.length=g-c.oldValue))}),r=d;break;case a._const.addTextElement:var y=(u=o[a._const.route].slice()).splice(u.length-1,1)[0];(f={}).nodeName="#text",f.data=o[a._const.value],(r=ce(n,u).node).childNodes||(r.childNodes=[]),y>=r.childNodes.length?r.childNodes.push(f):r.childNodes.splice(y,0,f),r.nodeName==="TEXTAREA"&&(r.value=o[a._const.newValue]),r.subsets&&r.subsets.forEach(function(c){if(c.oldValue>=y&&(c.oldValue+=1),c.oldValue<y&&c.oldValue+c.length>y){var V=c.oldValue+c.length-y;h.push({newValue:c.newValue+c.length-V,oldValue:y+1,length:V}),c.length-=V}});break;default:console.log("unknown action")}r.subsets&&(r.subsets=r.subsets.filter(function(c){return!c.delete&&c.oldValue!==c.newValue}),h.length&&(r.subsets=r.subsets.concat(h))),a.postVirtualDiffApply({node:v.node,diff:v.diff,newNode:f})})(i,s,t)}),!0}function U(i,e){e===void 0&&(e={valueDiffing:!0});var t={nodeName:i.nodeName};return i instanceof Text||i instanceof Comment?t.data=i.data:(i.attributes&&i.attributes.length>0&&(t.attributes={},Array.prototype.slice.call(i.attributes).forEach(function(s){return t.attributes[s.name]=s.value})),i.childNodes&&i.childNodes.length>0&&(t.childNodes=[],Array.prototype.slice.call(i.childNodes).forEach(function(s){return t.childNodes.push(U(s,e))})),e.valueDiffing&&(i instanceof HTMLTextAreaElement&&(t.value=i.value),i instanceof HTMLInputElement&&["radio","checkbox"].includes(i.type.toLowerCase())&&i.checked!==void 0?t.checked=i.checked:(i instanceof HTMLButtonElement||i instanceof HTMLDataElement||i instanceof HTMLInputElement||i instanceof HTMLLIElement||i instanceof HTMLMeterElement||i instanceof HTMLOptionElement||i instanceof HTMLProgressElement||i instanceof HTMLParamElement)&&(t.value=i.value),i instanceof HTMLOptionElement&&(t.selected=i.selected))),t}var Ae=/<\s*\/*[a-zA-Z:_][a-zA-Z0-9:_\-.]*\s*(?:"[^"]*"['"]*|'[^']*'['"]*|[^'"/>])*\/*\s*>|<!--(?:.|\n|\r)*?-->/g,Pe=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function we(i){return i.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}var ke={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuItem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},Ne=function(i){var e={nodeName:"",attributes:{}},t=!1,s=i.match(/<\/?([^\s]+?)[/\s>]/);if(s&&(e.nodeName=s[1],(ke[s[1]]||i.charAt(i.length-2)==="/")&&(t=!0),e.nodeName.startsWith("!--"))){var n=i.indexOf("-->");return{type:"comment",node:{nodeName:"#comment",data:n!==-1?i.slice(4,n):""},voidElement:t}}for(var o=new RegExp(Pe),a=null,l=!1;!l;)if((a=o.exec(i))===null)l=!0;else if(a[0].trim())if(a[1]){var r=a[1].trim(),d=[r,""];r.indexOf("=")>-1&&(d=r.split("=")),e.attributes[d[0]]=d[1],o.lastIndex--}else a[2]&&(e.attributes[a[2]]=a[3].trim().substring(1,a[3].length-1));return{type:"tag",node:e,voidElement:t}},Z=function(i,e){e===void 0&&(e={valueDiffing:!0});var t,s=[],n=-1,o=[];if(i.indexOf("<")!==0){var a=i.indexOf("<");s.push({nodeName:"#text",data:a===-1?i:i.substring(0,a)})}return i.replace(Ae,function(l,r){var d=l.charAt(1)!=="/",g=l.startsWith("<!--"),_=r+l.length,f=i.charAt(_);if(g){var u=Ne(l).node;if(n<0)return s.push(u),"";var h=o[n];return h&&u.nodeName&&(h.node.childNodes||(h.node.childNodes=[]),h.node.childNodes.push(u)),""}if(d){if(t=Ne(l),n++,!t.voidElement&&f&&f!=="<"){t.node.childNodes||(t.node.childNodes=[]);var v=we(i.slice(_,i.indexOf("<",_)));t.node.childNodes.push({nodeName:"#text",data:v}),e.valueDiffing&&t.node.nodeName==="TEXTAREA"&&(t.node.value=v)}n===0&&t.node.nodeName&&s.push(t.node);var w=o[n-1];w&&t.node.nodeName&&(w.node.childNodes||(w.node.childNodes=[]),w.node.childNodes.push(t.node)),o[n]=t}if((!d||t.voidElement)&&(n>-1&&(t.voidElement||t.node.nodeName.toUpperCase()===l.slice(2,-1).toUpperCase())&&--n>-1&&(t=o[n]),f!=="<"&&f)){var y=n===-1?s:o[n].node.childNodes||[],c=i.indexOf("<",_);v=we(i.slice(_,c===-1?void 0:c)),y.push({nodeName:"#text",data:v})}return""}),s[0]},Ce=function(){function i(e,t,s){this.options=s,this.t1=typeof Element<"u"&&e instanceof Element?U(e,this.options):typeof e=="string"?Z(e,this.options):JSON.parse(JSON.stringify(e)),this.t2=typeof Element<"u"&&t instanceof Element?U(t,this.options):typeof t=="string"?Z(t,this.options):JSON.parse(JSON.stringify(t)),this.diffcount=0,this.foundAll=!1,this.debug&&(this.t1Orig=typeof Element<"u"&&e instanceof Element?U(e,this.options):typeof e=="string"?Z(e,this.options):JSON.parse(JSON.stringify(e)),this.t2Orig=typeof Element<"u"&&t instanceof Element?U(t,this.options):typeof t=="string"?Z(t,this.options):JSON.parse(JSON.stringify(t))),this.tracker=new Se}return i.prototype.init=function(){return this.findDiffs(this.t1,this.t2)},i.prototype.findDiffs=function(e,t){var s;do{if(this.options.debug&&(this.diffcount+=1,this.diffcount>this.options.diffcap))throw new Error("surpassed diffcap:".concat(JSON.stringify(this.t1Orig)," -> ").concat(JSON.stringify(this.t2Orig)));(s=this.findNextDiff(e,t,[])).length===0&&(pe(e,t)||(this.foundAll?console.error("Could not find remaining diffs!"):(this.foundAll=!0,Me(e),s=this.findNextDiff(e,t,[])))),s.length>0&&(this.foundAll=!1,this.tracker.add(s),Le(e,s,this.options))}while(s.length>0);return this.tracker.list},i.prototype.findNextDiff=function(e,t,s){var n,o;if(this.options.maxDepth&&s.length>this.options.maxDepth)return[];if(!e.outerDone){if(n=this.findOuterDiff(e,t,s),this.options.filterOuterDiff&&(o=this.options.filterOuterDiff(e,t,n))&&(n=o),n.length>0)return e.outerDone=!0,n;e.outerDone=!0}if(Object.prototype.hasOwnProperty.call(e,"data"))return[];if(!e.innerDone){if((n=this.findInnerDiff(e,t,s)).length>0)return n;e.innerDone=!0}if(this.options.valueDiffing&&!e.valueDone){if((n=this.findValueDiff(e,t,s)).length>0)return e.valueDone=!0,n;e.valueDone=!0}return[]},i.prototype.findOuterDiff=function(e,t,s){var n,o,a,l,r,d,g=[];if(e.nodeName!==t.nodeName){if(!s.length)throw new Error("Top level nodes have to be of the same kind.");return[new H().setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,R(e)).setValue(this.options._const.newValue,R(t)).setValue(this.options._const.route,s)]}if(s.length&&this.options.diffcap<Math.abs((e.childNodes||[]).length-(t.childNodes||[]).length))return[new H().setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,R(e)).setValue(this.options._const.newValue,R(t)).setValue(this.options._const.route,s)];if(Object.prototype.hasOwnProperty.call(e,"data")&&e.data!==t.data)return e.nodeName==="#text"?[new H().setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,s).setValue(this.options._const.oldValue,e.data).setValue(this.options._const.newValue,t.data)]:[new H().setValue(this.options._const.action,this.options._const.modifyComment).setValue(this.options._const.route,s).setValue(this.options._const.oldValue,e.data).setValue(this.options._const.newValue,t.data)];for(o=e.attributes?Object.keys(e.attributes).sort():[],a=t.attributes?Object.keys(t.attributes).sort():[],l=o.length,d=0;d<l;d++)n=o[d],(r=a.indexOf(n))===-1?g.push(new H().setValue(this.options._const.action,this.options._const.removeAttribute).setValue(this.options._const.route,s).setValue(this.options._const.name,n).setValue(this.options._const.value,e.attributes[n])):(a.splice(r,1),e.attributes[n]!==t.attributes[n]&&g.push(new H().setValue(this.options._const.action,this.options._const.modifyAttribute).setValue(this.options._const.route,s).setValue(this.options._const.name,n).setValue(this.options._const.oldValue,e.attributes[n]).setValue(this.options._const.newValue,t.attributes[n])));for(l=a.length,d=0;d<l;d++)n=a[d],g.push(new H().setValue(this.options._const.action,this.options._const.addAttribute).setValue(this.options._const.route,s).setValue(this.options._const.name,n).setValue(this.options._const.value,t.attributes[n]));return g},i.prototype.findInnerDiff=function(e,t,s){var n=e.childNodes?e.childNodes.slice():[],o=t.childNodes?t.childNodes.slice():[],a=Math.max(n.length,o.length),l=Math.abs(n.length-o.length),r=[],d=0;if(!this.options.maxChildCount||a<this.options.maxChildCount){var g=!!(e.subsets&&e.subsetsAge--),_=g?e.subsets:e.childNodes&&t.childNodes?Te(e,t):[];if(_.length>0&&(r=this.attemptGroupRelocation(e,t,_,s,g)).length>0)return r}for(var f=0;f<a;f+=1){var u=n[f],h=o[f];if(l&&(u&&!h?u.nodeName==="#text"?(r.push(new H().setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,s.concat(d)).setValue(this.options._const.value,u.data)),d-=1):(r.push(new H().setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,s.concat(d)).setValue(this.options._const.element,R(u))),d-=1):h&&!u&&(h.nodeName==="#text"?r.push(new H().setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,s.concat(d)).setValue(this.options._const.value,h.data)):r.push(new H().setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,s.concat(d)).setValue(this.options._const.element,R(h))))),u&&h){if(!this.options.maxChildCount||a<this.options.maxChildCount)r=r.concat(this.findNextDiff(u,h,s.concat(d)));else if(!pe(u,h))if(n.length>o.length)u.nodeName==="#text"?r.push(new H().setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,s.concat(d)).setValue(this.options._const.value,u.data)):r.push(new H().setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.element,R(u)).setValue(this.options._const.route,s.concat(d))),n.splice(f,1),f-=1,d-=1,l-=1;else if(n.length<o.length){var v=R(h);r=r.concat([new H().setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.element,v).setValue(this.options._const.route,s.concat(d))]),n.splice(f,0,v),l-=1}else r=r.concat([new H().setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,R(u)).setValue(this.options._const.newValue,R(h)).setValue(this.options._const.route,s.concat(d))])}d+=1}return e.innerDone=!0,r},i.prototype.attemptGroupRelocation=function(e,t,s,n,o){for(var a,l,r,d,g,_,f=function($,T,S){var O=$.childNodes?ne($.childNodes.length,!0):[],N=T.childNodes?ne(T.childNodes.length,!0):[],P=0;return S.forEach(function(A){for(var D=A.oldValue+A.length,m=A.newValue+A.length,p=A.oldValue;p<D;p+=1)O[p]=P;for(p=A.newValue;p<m;p+=1)N[p]=P;P+=1}),{gaps1:O,gaps2:N}}(e,t,s),u=f.gaps1,h=f.gaps2,v=Math.min(u.length,h.length),w=[],y=0,c=0;y<v;c+=1,y+=1)if(!o||u[y]!==!0&&h[y]!==!0){if(u[y]===!0)if((d=e.childNodes[c]).nodeName==="#text")if(t.childNodes[y].nodeName==="#text"){if(d.data!==t.childNodes[y].data){for(_=c;e.childNodes.length>_+1&&e.childNodes[_+1].nodeName==="#text";)if(_+=1,t.childNodes[y].data===e.childNodes[_].data){g=!0;break}if(!g)return w.push(new H().setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,n.concat(y)).setValue(this.options._const.oldValue,d.data).setValue(this.options._const.newValue,t.childNodes[y].data)),w}}else w.push(new H().setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,n.concat(y)).setValue(this.options._const.value,d.data)),u.splice(y,1),v=Math.min(u.length,h.length),y-=1;else w.push(new H().setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,n.concat(y)).setValue(this.options._const.element,R(d))),u.splice(y,1),v=Math.min(u.length,h.length),y-=1;else if(h[y]===!0)(d=t.childNodes[y]).nodeName==="#text"?(w.push(new H().setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,n.concat(y)).setValue(this.options._const.value,d.data)),u.splice(y,0,!0),v=Math.min(u.length,h.length),c-=1):(w.push(new H().setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,n.concat(y)).setValue(this.options._const.element,R(d))),u.splice(y,0,!0),v=Math.min(u.length,h.length),c-=1);else if(u[y]!==h[y]){if(w.length>0)return w;if(r=s[u[y]],(l=Math.min(r.newValue,e.childNodes.length-r.length))!==r.oldValue){a=!1;for(var V=0;V<r.length;V+=1)_e(e.childNodes[l+V],e.childNodes[r.oldValue+V],{},!1,!0)||(a=!0);if(a)return[new H().setValue(this.options._const.action,this.options._const.relocateGroup).setValue(this.options._const.groupLength,r.length).setValue(this.options._const.from,r.oldValue).setValue(this.options._const.to,l).setValue(this.options._const.route,n)]}}}return w},i.prototype.findValueDiff=function(e,t,s){var n=[];return e.selected!==t.selected&&n.push(new H().setValue(this.options._const.action,this.options._const.modifySelected).setValue(this.options._const.oldValue,e.selected).setValue(this.options._const.newValue,t.selected).setValue(this.options._const.route,s)),(e.value||t.value)&&e.value!==t.value&&e.nodeName!=="OPTION"&&n.push(new H().setValue(this.options._const.action,this.options._const.modifyValue).setValue(this.options._const.oldValue,e.value||"").setValue(this.options._const.newValue,t.value||"").setValue(this.options._const.route,s)),e.checked!==t.checked&&n.push(new H().setValue(this.options._const.action,this.options._const.modifyChecked).setValue(this.options._const.oldValue,e.checked).setValue(this.options._const.newValue,t.checked).setValue(this.options._const.route,s)),n},i}(),He={debug:!1,diffcap:10,maxDepth:!1,maxChildCount:50,valueDiffing:!0,textDiff:function(i,e,t,s){i.data=s},preVirtualDiffApply:function(){},postVirtualDiffApply:function(){},preDiffApply:function(){},postDiffApply:function(){},filterOuterDiff:null,compress:!1,_const:!1,document:!(typeof window>"u"||!window.document)&&window.document,components:[]},Ye=function(){function i(e){if(e===void 0&&(e={}),Object.entries(He).forEach(function(n){var o=n[0],a=n[1];Object.prototype.hasOwnProperty.call(e,o)||(e[o]=a)}),!e._const){var t=["addAttribute","modifyAttribute","removeAttribute","modifyTextElement","relocateGroup","removeElement","addElement","removeTextElement","addTextElement","replaceElement","modifyValue","modifyChecked","modifySelected","modifyComment","action","route","oldValue","newValue","element","group","groupLength","from","to","name","value","data","attributes","nodeName","childNodes","checked","selected"],s={};e.compress?t.forEach(function(n,o){return s[n]=o}):t.forEach(function(n){return s[n]=n}),e._const=s}this.options=e}return i.prototype.apply=function(e,t){return function(s,n,o){return n.every(function(a){return q(s,a,o)})}(e,t,this.options)},i.prototype.undo=function(e,t){return $e(e,t,this.options)},i.prototype.diff=function(e,t){return new Ce(e,t,this.options).init()},i}();const fe=(i,e,t,{classes:s,format:n,hiddenHeader:o,sortable:a,scrollY:l,type:r},{noColumnWidths:d,unhideHeader:g})=>({nodeName:"TR",childNodes:i.map((_,f)=>{const u=e[f]||{type:r,format:n,sortable:!0,searchable:!0};if(u.hidden)return;const h={};if(u.sortable&&a&&(!l.length||g)&&(u.filter?h["data-filterable"]="true":h["data-sortable"]="true"),u.headerClass&&(h.class=u.headerClass),t.sort&&t.sort.column===f){const y=t.sort.dir==="asc"?s.ascending:s.descending;h.class=h.class?`${h.class} ${y}`:y,h["aria-sort"]=t.sort.dir==="asc"?"ascending":"descending"}else t.filters[f]&&(h.class=h.class?`${h.class} ${s.filterActive}`:s.filterActive);let v="";t.widths[f]&&!d&&(v+=`width: ${t.widths[f]}%;`),l.length&&!g&&(v+="padding-bottom: 0;padding-top: 0;border: 0;"),v.length&&(h.style=v);const w=_.type==="html"?_.data:[{nodeName:"#text",data:_.text??String(_.data)}];return{nodeName:"TH",attributes:h,childNodes:!o&&!l.length||g?u.sortable&&a?[{nodeName:"a",attributes:{href:"#",class:u.filter?s.filter:s.sorter},childNodes:w}]:w:[{nodeName:"#text",data:""}]}}).filter(_=>_)}),De=(i,e,t,s,n,o,{classes:a,hiddenHeader:l,header:r,footer:d,format:g,sortable:_,scrollY:f,type:u,rowRender:h,tabIndex:v},{noColumnWidths:w,unhideHeader:y,renderHeader:c})=>{const V={nodeName:"TABLE",attributes:{...i},childNodes:[{nodeName:"TBODY",childNodes:t.map(({row:$,index:T})=>{const S={nodeName:"TR",attributes:{"data-index":String(T)},childNodes:$.map((O,N)=>{const P=s[N]||{type:u,format:g,sortable:!0,searchable:!0};if(P.hidden)return;const A=P.type==="html"?{nodeName:"TD",childNodes:O.data}:{nodeName:"TD",childNodes:[{nodeName:"#text",data:O.text??String(O.data)}]};if(r||d||!n.widths[N]||w||(A.attributes={style:`width: ${n.widths[N]}%;`}),P.cellClass&&(A.attributes||(A.attributes={}),A.attributes.class=P.cellClass),P.render){const D=P.render(O.data,A,T,N);if(D){if(typeof D!="string")return D;{const m=Z(`<td>${D}</td>`);m.childNodes.length===1&&["#text","#comment"].includes(m.childNodes[0].nodeName)?A.childNodes[0].data=D:A.childNodes=m.childNodes}}}return A}).filter(O=>O)};if(T===o&&(S.attributes.class=a.cursor),h){const O=h($,S,T);if(O){if(typeof O!="string")return O;{const N=Z(`<tr>${O}</tr>`);!N.childNodes||N.childNodes.length===1&&["#text","#comment"].includes(N.childNodes[0].nodeName)?S.childNodes[0].data=O:S.childNodes=N.childNodes}}}return S})}]};if(V.attributes.class=V.attributes.class?`${V.attributes.class} ${a.table}`:a.table,r||d||c){const $=fe(e,s,n,{classes:a,hiddenHeader:l,sortable:_,scrollY:f},{noColumnWidths:w,unhideHeader:y});if(r||c){const T={nodeName:"THEAD",childNodes:[$]};!f.length&&!l||y||(T.attributes={style:"height: 0px;"}),V.childNodes.unshift(T)}if(d){const T={nodeName:"TFOOT",childNodes:[r?structuredClone($):$]};!f.length&&!l||y||(T.attributes={style:"height: 0px;"}),V.childNodes.push(T)}}return v!==!1&&(V.attributes.tabindex=String(v)),V};var me={};({get exports(){return me},set exports(i){me=i}}).exports=function(){var i=1e3,e=6e4,t=36e5,s="millisecond",n="second",o="minute",a="hour",l="day",r="week",d="month",g="quarter",_="year",f="date",u="Invalid Date",h=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,w={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(D){var m=["th","st","nd","rd"],p=D%100;return"["+D+(m[(p-20)%10]||m[p]||m[0])+"]"}},y=function(D,m,p){var M=String(D);return!M||M.length>=m?D:""+Array(m+1-M.length).join(p)+D},c={s:y,z:function(D){var m=-D.utcOffset(),p=Math.abs(m),M=Math.floor(p/60),b=p%60;return(m<=0?"+":"-")+y(M,2,"0")+":"+y(b,2,"0")},m:function D(m,p){if(m.date()<p.date())return-D(p,m);var M=12*(p.year()-m.year())+(p.month()-m.month()),b=m.clone().add(M,d),E=p-b<0,x=m.clone().add(M+(E?-1:1),d);return+(-(M+(p-b)/(E?b-x:x-b))||0)},a:function(D){return D<0?Math.ceil(D)||0:Math.floor(D)},p:function(D){return{M:d,y:_,w:r,d:l,D:f,h:a,m:o,s:n,ms:s,Q:g}[D]||String(D||"").toLowerCase().replace(/s$/,"")},u:function(D){return D===void 0}},V="en",$={};$[V]=w;var T=function(D){return D instanceof P},S=function D(m,p,M){var b;if(!m)return V;if(typeof m=="string"){var E=m.toLowerCase();$[E]&&(b=E),p&&($[E]=p,b=E);var x=m.split("-");if(!b&&x.length>1)return D(x[0])}else{var L=m.name;$[L]=m,b=L}return!M&&b&&(V=b),b||!M&&V},O=function(D,m){if(T(D))return D.clone();var p=typeof m=="object"?m:{};return p.date=D,p.args=arguments,new P(p)},N=c;N.l=S,N.i=T,N.w=function(D,m){return O(D,{locale:m.$L,utc:m.$u,x:m.$x,$offset:m.$offset})};var P=function(){function D(p){this.$L=S(p.locale,null,!0),this.parse(p)}var m=D.prototype;return m.parse=function(p){this.$d=function(M){var b=M.date,E=M.utc;if(b===null)return new Date(NaN);if(N.u(b))return new Date;if(b instanceof Date)return new Date(b);if(typeof b=="string"&&!/Z$/i.test(b)){var x=b.match(h);if(x){var L=x[2]-1||0,k=(x[7]||"0").substring(0,3);return E?new Date(Date.UTC(x[1],L,x[3]||1,x[4]||0,x[5]||0,x[6]||0,k)):new Date(x[1],L,x[3]||1,x[4]||0,x[5]||0,x[6]||0,k)}}return new Date(b)}(p),this.$x=p.x||{},this.init()},m.init=function(){var p=this.$d;this.$y=p.getFullYear(),this.$M=p.getMonth(),this.$D=p.getDate(),this.$W=p.getDay(),this.$H=p.getHours(),this.$m=p.getMinutes(),this.$s=p.getSeconds(),this.$ms=p.getMilliseconds()},m.$utils=function(){return N},m.isValid=function(){return this.$d.toString()!==u},m.isSame=function(p,M){var b=O(p);return this.startOf(M)<=b&&b<=this.endOf(M)},m.isAfter=function(p,M){return O(p)<this.startOf(M)},m.isBefore=function(p,M){return this.endOf(M)<O(p)},m.$g=function(p,M,b){return N.u(p)?this[M]:this.set(b,p)},m.unix=function(){return Math.floor(this.valueOf()/1e3)},m.valueOf=function(){return this.$d.getTime()},m.startOf=function(p,M){var b=this,E=!!N.u(M)||M,x=N.p(p),L=function(F,I){var j=N.w(b.$u?Date.UTC(b.$y,I,F):new Date(b.$y,I,F),b);return E?j:j.endOf(l)},k=function(F,I){return N.w(b.toDate()[F].apply(b.toDate("s"),(E?[0,0,0,0]:[23,59,59,999]).slice(I)),b)},C=this.$W,Y=this.$M,B=this.$D,W="set"+(this.$u?"UTC":"");switch(x){case _:return E?L(1,0):L(31,11);case d:return E?L(1,Y):L(0,Y+1);case r:var X=this.$locale().weekStart||0,Q=(C<X?C+7:C)-X;return L(E?B-Q:B+(6-Q),Y);case l:case f:return k(W+"Hours",0);case a:return k(W+"Minutes",1);case o:return k(W+"Seconds",2);case n:return k(W+"Milliseconds",3);default:return this.clone()}},m.endOf=function(p){return this.startOf(p,!1)},m.$set=function(p,M){var b,E=N.p(p),x="set"+(this.$u?"UTC":""),L=(b={},b[l]=x+"Date",b[f]=x+"Date",b[d]=x+"Month",b[_]=x+"FullYear",b[a]=x+"Hours",b[o]=x+"Minutes",b[n]=x+"Seconds",b[s]=x+"Milliseconds",b)[E],k=E===l?this.$D+(M-this.$W):M;if(E===d||E===_){var C=this.clone().set(f,1);C.$d[L](k),C.init(),this.$d=C.set(f,Math.min(this.$D,C.daysInMonth())).$d}else L&&this.$d[L](k);return this.init(),this},m.set=function(p,M){return this.clone().$set(p,M)},m.get=function(p){return this[N.p(p)]()},m.add=function(p,M){var b,E=this;p=Number(p);var x=N.p(M),L=function(Y){var B=O(E);return N.w(B.date(B.date()+Math.round(Y*p)),E)};if(x===d)return this.set(d,this.$M+p);if(x===_)return this.set(_,this.$y+p);if(x===l)return L(1);if(x===r)return L(7);var k=(b={},b[o]=e,b[a]=t,b[n]=i,b)[x]||1,C=this.$d.getTime()+p*k;return N.w(C,this)},m.subtract=function(p,M){return this.add(-1*p,M)},m.format=function(p){var M=this,b=this.$locale();if(!this.isValid())return b.invalidDate||u;var E=p||"YYYY-MM-DDTHH:mm:ssZ",x=N.z(this),L=this.$H,k=this.$m,C=this.$M,Y=b.weekdays,B=b.months,W=function(I,j,z,J){return I&&(I[j]||I(M,E))||z[j].slice(0,J)},X=function(I){return N.s(L%12||12,I,"0")},Q=b.meridiem||function(I,j,z){var J=I<12?"AM":"PM";return z?J.toLowerCase():J},F={YY:String(this.$y).slice(-2),YYYY:this.$y,M:C+1,MM:N.s(C+1,2,"0"),MMM:W(b.monthsShort,C,B,3),MMMM:W(B,C),D:this.$D,DD:N.s(this.$D,2,"0"),d:String(this.$W),dd:W(b.weekdaysMin,this.$W,Y,2),ddd:W(b.weekdaysShort,this.$W,Y,3),dddd:Y[this.$W],H:String(L),HH:N.s(L,2,"0"),h:X(1),hh:X(2),a:Q(L,k,!0),A:Q(L,k,!1),m:String(k),mm:N.s(k,2,"0"),s:String(this.$s),ss:N.s(this.$s,2,"0"),SSS:N.s(this.$ms,3,"0"),Z:x};return E.replace(v,function(I,j){return j||F[I]||x.replace(":","")})},m.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},m.diff=function(p,M,b){var E,x=N.p(M),L=O(p),k=(L.utcOffset()-this.utcOffset())*e,C=this-L,Y=N.m(this,L);return Y=(E={},E[_]=Y/12,E[d]=Y,E[g]=Y/3,E[r]=(C-k)/6048e5,E[l]=(C-k)/864e5,E[a]=C/t,E[o]=C/e,E[n]=C/i,E)[x]||C,b?Y:N.a(Y)},m.daysInMonth=function(){return this.endOf(d).$D},m.$locale=function(){return $[this.$L]},m.locale=function(p,M){if(!p)return this.$L;var b=this.clone(),E=S(p,M,!0);return E&&(b.$L=E),b},m.clone=function(){return N.w(this.$d,this)},m.toDate=function(){return new Date(this.valueOf())},m.toJSON=function(){return this.isValid()?this.toISOString():null},m.toISOString=function(){return this.$d.toISOString()},m.toString=function(){return this.$d.toUTCString()},D}(),A=P.prototype;return O.prototype=A,[["$ms",s],["$s",n],["$m",o],["$H",a],["$W",l],["$M",d],["$y",_],["$D",f]].forEach(function(D){A[D[1]]=function(m){return this.$g(m,D[0],D[1])}}),O.extend=function(D,m){return D.$i||(D(m,P,O),D.$i=!0),O},O.locale=S,O.isDayjs=T,O.unix=function(D){return O(1e3*D)},O.en=$[V],O.Ls=$,O.p={},O}();var ee=me,ge={};({get exports(){return ge},set exports(i){ge=i}}).exports=function(){var i={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},e=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|YYYY|YY?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,t=/\d\d/,s=/\d\d?/,n=/\d*[^-_:/,()\s\d]+/,o={},a=function(u){return(u=+u)+(u>68?1900:2e3)},l=function(u){return function(h){this[u]=+h}},r=[/[+-]\d\d:?(\d\d)?|Z/,function(u){(this.zone||(this.zone={})).offset=function(h){if(!h||h==="Z")return 0;var v=h.match(/([+-]|\d\d)/g),w=60*v[1]+(+v[2]||0);return w===0?0:v[0]==="+"?-w:w}(u)}],d=function(u){var h=o[u];return h&&(h.indexOf?h:h.s.concat(h.f))},g=function(u,h){var v,w=o.meridiem;if(w){for(var y=1;y<=24;y+=1)if(u.indexOf(w(y,0,h))>-1){v=y>12;break}}else v=u===(h?"pm":"PM");return v},_={A:[n,function(u){this.afternoon=g(u,!1)}],a:[n,function(u){this.afternoon=g(u,!0)}],S:[/\d/,function(u){this.milliseconds=100*+u}],SS:[t,function(u){this.milliseconds=10*+u}],SSS:[/\d{3}/,function(u){this.milliseconds=+u}],s:[s,l("seconds")],ss:[s,l("seconds")],m:[s,l("minutes")],mm:[s,l("minutes")],H:[s,l("hours")],h:[s,l("hours")],HH:[s,l("hours")],hh:[s,l("hours")],D:[s,l("day")],DD:[t,l("day")],Do:[n,function(u){var h=o.ordinal,v=u.match(/\d+/);if(this.day=v[0],h)for(var w=1;w<=31;w+=1)h(w).replace(/\[|\]/g,"")===u&&(this.day=w)}],M:[s,l("month")],MM:[t,l("month")],MMM:[n,function(u){var h=d("months"),v=(d("monthsShort")||h.map(function(w){return w.slice(0,3)})).indexOf(u)+1;if(v<1)throw new Error;this.month=v%12||v}],MMMM:[n,function(u){var h=d("months").indexOf(u)+1;if(h<1)throw new Error;this.month=h%12||h}],Y:[/[+-]?\d+/,l("year")],YY:[t,function(u){this.year=a(u)}],YYYY:[/\d{4}/,l("year")],Z:r,ZZ:r};function f(u){var h,v;h=u,v=o&&o.formats;for(var w=(u=h.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(O,N,P){var A=P&&P.toUpperCase();return N||v[P]||i[P]||v[A].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(D,m,p){return m||p.slice(1)})})).match(e),y=w.length,c=0;c<y;c+=1){var V=w[c],$=_[V],T=$&&$[0],S=$&&$[1];w[c]=S?{regex:T,parser:S}:V.replace(/^\[|\]$/g,"")}return function(O){for(var N={},P=0,A=0;P<y;P+=1){var D=w[P];if(typeof D=="string")A+=D.length;else{var m=D.regex,p=D.parser,M=O.slice(A),b=m.exec(M)[0];p.call(N,b),O=O.replace(b,"")}}return function(E){var x=E.afternoon;if(x!==void 0){var L=E.hours;x?L<12&&(E.hours+=12):L===12&&(E.hours=0),delete E.afternoon}}(N),N}}return function(u,h,v){v.p.customParseFormat=!0,u&&u.parseTwoDigitYear&&(a=u.parseTwoDigitYear);var w=h.prototype,y=w.parse;w.parse=function(c){var V=c.date,$=c.utc,T=c.args;this.$u=$;var S=T[1];if(typeof S=="string"){var O=T[2]===!0,N=T[3]===!0,P=O||N,A=T[2];N&&(A=T[2]),o=this.$locale(),!O&&A&&(o=v.Ls[A]),this.$d=function(M,b,E){try{if(["x","X"].indexOf(b)>-1)return new Date((b==="X"?1e3:1)*M);var x=f(b)(M),L=x.year,k=x.month,C=x.day,Y=x.hours,B=x.minutes,W=x.seconds,X=x.milliseconds,Q=x.zone,F=new Date,I=C||(L||k?1:F.getDate()),j=L||F.getFullYear(),z=0;L&&!k||(z=k>0?k-1:F.getMonth());var J=Y||0,ae=B||0,oe=W||0,re=X||0;return Q?new Date(Date.UTC(j,z,I,J,ae,oe,re+60*Q.offset*1e3)):E?new Date(Date.UTC(j,z,I,J,ae,oe,re)):new Date(j,z,I,J,ae,oe,re)}catch{return new Date("")}}(V,S,$),this.init(),A&&A!==!0&&(this.$L=this.locale(A).$L),P&&V!=this.format(S)&&(this.$d=new Date("")),o={}}else if(S instanceof Array)for(var D=S.length,m=1;m<=D;m+=1){T[1]=S[m-1];var p=v.apply(this,T);if(p.isValid()){this.$d=p.$d,this.$L=p.$L,this.init();break}m===D&&(this.$d=new Date(""))}else y.call(this,c)}}}();var Ie=ge;ee.extend(Ie);const Ee=(i,e)=>{let t;if(e)switch(e){case"ISO_8601":t=i;break;case"RFC_2822":t=ee(i.slice(5),"DD MMM YYYY HH:mm:ss ZZ").unix();break;case"MYSQL":t=ee(i,"YYYY-MM-DD hh:mm:ss").unix();break;case"UNIX":t=ee(i).unix();break;default:t=ee(i,e,!0).valueOf()}return t},G=(i,e)=>{if((i==null?void 0:i.constructor)===Object&&Object.prototype.hasOwnProperty.call(i,"data")&&!Object.keys(i).find(s=>!["text","order","data"].includes(s)))return i;const t={data:i};switch(e.type){case"string":typeof i!="string"&&(t.text=String(t.data),t.order=t.text);break;case"date":e.format&&(t.order=Ee(String(t.data),e.format));break;case"number":t.text=String(t.data),t.data=parseInt(t.data,10);break;case"html":{const s=Array.isArray(t.data)?{nodeName:"TD",childNodes:t.data}:Z(`<td>${String(t.data)}</td>`);t.data=s.childNodes||[];const n=ie(s);t.text=n,t.order=n;break}case"boolean":typeof t.data=="string"&&(t.data=t.data.toLowerCase().trim()),t.data=!["false",!1,null,void 0,0].includes(t.data),t.order=t.data?1:0,t.text=String(t.data);break;case"other":t.text="",t.order=0;break;default:t.text=JSON.stringify(t.data)}return t},te=i=>{if(i instanceof Object&&i.constructor===Object&&i.hasOwnProperty("data")&&(typeof i.text=="string"||typeof i.data=="string"))return i;const e={data:i};if(typeof i=="string"){if(i.length){const t=Z(`<th>${i}</th>`);if(t.childNodes&&(t.childNodes.length!==1||t.childNodes[0].nodeName!=="#text")){e.data=t.childNodes,e.type="html";const s=ie(t);e.text=s}}}else[null,void 0].includes(i)?e.text="":e.text=JSON.stringify(i);return e},Ve=(i,e,t,s,n)=>{var a,l;const o={data:[],headings:[]};i.headings?o.headings=i.headings.map(r=>te(r)):e!=null&&e.tHead?o.headings=Array.from(e.tHead.querySelectorAll("th")).map((r,d)=>{var f,u,h,v,w;const g=(y=>{const c=U(y,{valueDiffing:!1});let V;return V=!c.childNodes||c.childNodes.length===1&&c.childNodes[0].nodeName==="#text"?{data:y.innerText,type:"string"}:{data:c.childNodes,type:"html",text:ie(c)},V})(r);t[d]||(t[d]={type:s,format:n,searchable:!0,sortable:!0,isSplitQueryWord:!0});const _=t[d];return((f=r.dataset.sortable)==null?void 0:f.trim().toLowerCase())!=="false"&&((u=r.dataset.sort)==null?void 0:u.trim().toLowerCase())!=="false"||(_.sortable=!1),((h=r.dataset.searchable)==null?void 0:h.trim().toLowerCase())==="false"&&(_.searchable=!1),((v=r.dataset.hidden)==null?void 0:v.trim().toLowerCase())!=="true"&&((w=r.getAttribute("hidden"))==null?void 0:w.trim().toLowerCase())!=="true"||(_.hidden=!0),["number","string","html","date","boolean","other"].includes(r.dataset.type)&&(_.type=r.dataset.type,_.type==="date"&&r.dataset.format&&(_.format=r.dataset.format)),g}):(a=i.data)!=null&&a.length?o.headings=i.data[0].map(r=>te("")):e!=null&&e.tBodies.length&&(o.headings=Array.from(e.tBodies[0].rows[0].cells).map(r=>te("")));for(let r=0;r<o.headings.length;r++)t[r]||(t[r]={type:s,format:n,sortable:!0,searchable:!0});if(i.data?o.data=i.data.map(r=>r.map((d,g)=>G(d,t[g]))):(l=e==null?void 0:e.tBodies)!=null&&l.length&&(o.data=Array.from(e.tBodies[0].rows).map(r=>Array.from(r.cells).map((d,g)=>{const _=d.dataset.content?G(d.dataset.content,t[g]):((f,u)=>{let h;switch(u.type){case"string":h={data:f.innerText};break;case"date":{const v=f.innerText;h={data:v,order:Ee(v,u.format)};break}case"number":h={data:parseInt(f.innerText,10),text:f.innerText};break;case"boolean":{const v=!["false","0","null","undefined"].includes(f.innerText.toLowerCase().trim());h={data:v,order:v?1:0,text:v?"1":"0"};break}default:h={data:U(f,{valueDiffing:!1}).childNodes||[],text:f.innerText,order:f.innerText}}return h})(d,t[g]);return d.dataset.order&&(_.order=isNaN(parseFloat(d.dataset.order))?d.dataset.order:parseFloat(d.dataset.order)),_}))),o.data.length&&o.data[0].length!==o.headings.length)throw new Error("Data heading length mismatch.");return o};class Re{constructor(e){this.dt=e,this.cursor=!1}setCursor(e=!1){if(e===this.cursor)return;const t=this.cursor;if(this.cursor=e,this.dt._renderTable(),e!==!1&&this.dt.options.scrollY){const s=this.dt.dom.querySelector(`tr.${this.dt.options.classes.cursor}`);s&&s.scrollIntoView({block:"nearest"})}this.dt.emit("datatable.cursormove",this.cursor,t)}add(e){const t=e.map((s,n)=>{const o=this.dt.columns.settings[n];return G(s,o)});this.dt.data.data.push(t),this.dt.data.data.length&&(this.dt.hasRows=!0),this.dt.update(!0)}remove(e){if(!Array.isArray(e))return this.remove([e]);this.dt.data.data=this.dt.data.data.filter((t,s)=>!e.includes(s)),this.dt.data.data.length||(this.dt.hasRows=!1),this.dt.update(!0)}findRowIndex(e,t){return this.dt.data.data.findIndex(s=>(s[e].text??String(s[e].data)).toLowerCase().includes(String(t).toLowerCase()))}findRow(e,t){const s=this.findRowIndex(e,t);if(s<0)return{index:-1,row:null,cols:[]};const n=this.dt.data.data[s],o=n.map(a=>a.data);return{index:s,row:n,cols:o}}updateRow(e,t){const s=t.map((n,o)=>{const a=this.dt.columns.settings[o];return G(n,a)});this.dt.data.data.splice(e,1,s),this.dt.update(!0)}}class je{constructor(e){this.dt=e,this.init()}init(){[this.settings,this._state]=((e=[],t,s)=>{let n=[],o=!1;const a=[];return e.forEach(l=>{(Array.isArray(l.select)?l.select:[l.select]).forEach(r=>{n[r]||(n[r]={type:l.type||t,sortable:!0,searchable:!0,isSplitQueryWord:!0,searchQuerySeparator:" "});const d=n[r];l.render&&(d.render=l.render),l.format?d.format=l.format:l.type==="date"&&(d.format=s),l.cellClass&&(d.cellClass=l.cellClass),l.headerClass&&(d.headerClass=l.headerClass),l.locale&&(d.locale=l.locale),l.sortable===!1?d.sortable=!1:(l.numeric&&(d.numeric=l.numeric),l.caseFirst&&(d.caseFirst=l.caseFirst)),l.searchable===!1?d.searchable=!1:l.sensitivity&&(d.sensitivity=l.sensitivity),(d.searchable||d.sortable)&&l.ignorePunctuation&&(d.ignorePunctuation=l.ignorePunctuation),l.hidden&&(d.hidden=!0),l.filter&&(d.filter=l.filter),l.sortSequence&&(d.sortSequence=l.sortSequence),l.sort&&(l.filter?a[r]=l.sort:o={column:r,dir:l.sort}),l.isSplitQueryWord!==void 0&&(d.isSplitQueryWord=l.isSplitQueryWord),l.searchQuerySeparator!==void 0&&(d.searchQuerySeparator=l.searchQuerySeparator)})}),n=n.map(l=>l||{type:t,format:t==="date"?s:void 0,sortable:!0,searchable:!0,isSplitQueryWord:!0,searchQuerySeparator:" "}),[n,{filters:a,sort:o,widths:[]}]})(this.dt.options.columns,this.dt.options.type,this.dt.options.format)}swap(e){if(e.length===2){const t=this.dt.data.headings.map((a,l)=>l),s=e[0],n=e[1],o=t[n];return t[n]=t[s],t[s]=o,this.order(t)}}order(e){this.dt.data.headings=e.map(t=>this.dt.data.headings[t]),this.dt.data.data=this.dt.data.data.map(t=>e.map(s=>t[s])),this.settings=e.map(t=>this.settings[t]),this.dt.update()}hide(e){e.length&&(e.forEach(t=>{this.settings[t]||(this.settings[t]={type:"string"}),this.settings[t].hidden=!0}),this.dt.update())}show(e){e.length&&(e.forEach(t=>{this.settings[t]||(this.settings[t]={type:"string",sortable:!0}),delete this.settings[t].hidden}),this.dt.update())}visible(e){var t;return e===void 0&&(e=[...Array(this.dt.data.headings.length).keys()]),Array.isArray(e)?e.map(s=>{var n;return!((n=this.settings[s])!=null&&n.hidden)}):!((t=this.settings[e])!=null&&t.hidden)}add(e){const t=this.dt.data.headings.length;if(this.dt.data.headings=this.dt.data.headings.concat([te(e.heading)]),this.dt.data.data=this.dt.data.data.map((s,n)=>s.concat([G(e.data[n],e)])),this.settings[t]={type:e.type||"string",sortable:!0,searchable:!0},e.type||e.format||e.sortable||e.render||e.filter){const s=this.settings[t];e.render&&(s.render=e.render),e.format&&(s.format=e.format),e.cellClass&&(s.cellClass=e.cellClass),e.headerClass&&(s.headerClass=e.headerClass),e.locale&&(s.locale=e.locale),e.sortable===!1?s.sortable=!1:(e.numeric&&(s.numeric=e.numeric),e.caseFirst&&(s.caseFirst=e.caseFirst)),e.searchable===!1?s.searchable=!1:e.sensitivity&&(s.sensitivity=e.sensitivity),(s.searchable||s.sortable)&&e.ignorePunctuation&&(s.ignorePunctuation=e.ignorePunctuation),e.hidden&&(s.hidden=!0),e.filter&&(s.filter=e.filter),e.sortSequence&&(s.sortSequence=e.sortSequence)}this.dt.update(!0)}remove(e){if(!Array.isArray(e))return this.remove([e]);this.dt.data.headings=this.dt.data.headings.filter((t,s)=>!e.includes(s)),this.dt.data.data=this.dt.data.data.map(t=>t.filter((s,n)=>!e.includes(n))),this.dt.update(!0)}filter(e,t=!1){var o,a;if(!((a=(o=this.settings[e])==null?void 0:o.filter)!=null&&a.length))return;const s=this._state.filters[e];let n;if(s){let l=!1;n=this.settings[e].filter.find(r=>!!l||(r===s&&(l=!0),!1))}else{const l=this.settings[e].filter;n=l?l[0]:void 0}n?this._state.filters[e]=n:s&&(this._state.filters[e]=void 0),this.dt._currentPage=1,this.dt.update(),t||this.dt.emit("datatable.filter",e,n)}sort(e,t,s=!1){var a;const n=this.settings[e];if(s||this.dt.emit("datatable.sorting",e,t),!t){const l=!(!this._state.sort||this._state.sort.column!==e)&&((a=this._state.sort)==null?void 0:a.dir),r=(n==null?void 0:n.sortSequence)||["asc","desc"];if(l){const d=r.indexOf(l);t=d===-1?r[0]||"asc":d===r.length-1?r[0]:r[d+1]}else t=r.length?r[0]:"asc"}const o=!!["string","html"].includes(n.type)&&new Intl.Collator(n.locale||this.dt.options.locale,{usage:"sort",numeric:n.numeric||this.dt.options.numeric,caseFirst:n.caseFirst||this.dt.options.caseFirst,ignorePunctuation:n.ignorePunctuation||this.dt.options.ignorePunctuation});this.dt.data.data.sort((l,r)=>{let d=l[e].order||l[e].data,g=r[e].order||r[e].data;if(t==="desc"){const _=d;d=g,g=_}return o?o.compare(String(d),String(g)):d<g?-1:d>g?1:0}),this._state.sort={column:e,dir:t},this.dt._searchQueries.length?(this.dt.multiSearch(this.dt._searchQueries),this.dt.emit("datatable.sort",e,t)):s||(this.dt._currentPage=1,this.dt.update(),this.dt.emit("datatable.sort",e,t))}_measureWidths(){var t,s,n,o;const e=this.dt.data.headings.filter((a,l)=>{var r;return!((r=this.settings[l])!=null&&r.hidden)});if((this.dt.options.scrollY.length||this.dt.options.fixedColumns)&&(e!=null&&e.length)){this._state.widths=[];const a={noPaging:!0};if(this.dt.options.header||this.dt.options.footer){this.dt.options.scrollY.length&&(a.unhideHeader=!0),this.dt.headerDOM&&this.dt.headerDOM.parentElement.removeChild(this.dt.headerDOM),a.noColumnWidths=!0,this.dt._renderTable(a);const l=Array.from(((s=(t=this.dt.dom.querySelector("thead, tfoot"))==null?void 0:t.firstElementChild)==null?void 0:s.querySelectorAll("th"))||[]);let r=0;const d=this.dt.data.headings.map((_,f)=>{var h;if((h=this.settings[f])!=null&&h.hidden)return 0;const u=l[r].offsetWidth;return r+=1,u}),g=d.reduce((_,f)=>_+f,0);this._state.widths=d.map(_=>_/g*100)}else{a.renderHeader=!0,this.dt._renderTable(a);const l=Array.from(((o=(n=this.dt.dom.querySelector("thead, tfoot"))==null?void 0:n.firstElementChild)==null?void 0:o.querySelectorAll("th"))||[]);let r=0;const d=this.dt.data.headings.map((_,f)=>{var h;if((h=this.settings[f])!=null&&h.hidden)return 0;const u=l[r].offsetWidth;return r+=1,u}),g=d.reduce((_,f)=>_+f,0);this._state.widths=d.map(_=>_/g*100)}this.dt._renderTable()}}}const se={sortable:!0,locale:"en",numeric:!0,caseFirst:"false",searchable:!0,sensitivity:"base",ignorePunctuation:!0,destroyable:!0,isSplitQueryWord:!0,searchQuerySeparator:" ",data:{},type:"html",format:"YYYY-MM-DD",columns:[],paging:!0,perPage:10,perPageSelect:[5,10,15,20,25],nextPrev:!0,firstLast:!1,prevText:"",nextText:"",firstText:"",lastText:"",ellipsisText:"",truncatePager:!0,pagerDelta:2,scrollY:"",fixedColumns:!0,fixedHeight:!1,footer:!1,header:!0,hiddenHeader:!1,rowNavigation:!1,tabIndex:!1,pagerRender:!1,rowRender:!1,tableRender:!1,diffDomOptions:{valueDiffing:!1},labels:{placeholder:"Search...",searchTitle:"Search within table",perPage:"entries per page",noRows:"No entries found",noResults:"No results match your search query",info:"Showing {start} to {end} of {rows} entries"},template:(i,e)=>`<div class='${i.classes.top}'>
    ${i.paging&&i.perPageSelect?`<div class='${i.classes.dropdown}'>
            <label>
                <select class='${i.classes.selector}'></select> ${i.labels.perPage}
            </label>
        </div>`:""}
    ${i.searchable?`<div class='${i.classes.search}'>
            <input class='${i.classes.input}' placeholder='${i.labels.placeholder}' type='search' title='${i.labels.searchTitle}'${e.id?` aria-controls="${e.id}"`:""}>
        </div>`:""}
</div>
<div class='${i.classes.container}'${i.scrollY.length?` style='height: ${i.scrollY}; overflow-Y: auto;'`:""}></div>
<div class='${i.classes.bottom}'>
    ${i.paging?`<div class='${i.classes.info}'></div>`:""}
    <nav class='${i.classes.pagination}'></nav>
</div>`,classes:{active:"datatable-active",ascending:"datatable-ascending",bottom:"datatable-bottom",container:"datatable-container",cursor:"datatable-cursor",descending:"datatable-descending",disabled:"datatable-disabled",dropdown:"datatable-dropdown",ellipsis:"datatable-ellipsis",filter:"datatable-filter",filterActive:"datatable-filter-active",empty:"datatable-empty",headercontainer:"datatable-headercontainer",hidden:"datatable-hidden",info:"datatable-info",input:"datatable-input",loading:"datatable-loading",pagination:"datatable-pagination",paginationList:"datatable-pagination-list",paginationListItem:"datatable-pagination-list-item",paginationListItemLink:"datatable-pagination-list-item-link",search:"datatable-search",selector:"datatable-selector",sorter:"datatable-sorter",table:"datatable-table",top:"datatable-top",wrapper:"datatable-wrapper"}},K=(i,e,t,s={})=>({nodeName:"LI",attributes:{class:s.active&&!s.hidden?`${t.classes.paginationListItem} ${t.classes.active}`:s.hidden?`${t.classes.paginationListItem} ${t.classes.hidden} ${t.classes.disabled}`:t.classes.paginationListItem},childNodes:[{nodeName:"A",attributes:{"data-page":String(i),class:t.classes.paginationListItemLink},childNodes:[{nodeName:"#text",data:e}]}]}),We=(i,e,t,s,n)=>{let o=[];if(n.firstLast&&o.push(K(1,n.firstText,n)),n.nextPrev){const l=i?1:t-1;o.push(K(l,n.prevText,n,{hidden:i}))}let a=[...Array(s).keys()].map(l=>K(l+1,String(l+1),n,{active:l===t-1}));if(n.truncatePager&&(a=((l,r,d,g)=>{const _=g.pagerDelta,f=g.classes,u=g.ellipsisText,h=2*_;let v=r-_,w=r+_;r<4-_+h?w=3+h:r>d-(3-_+h)&&(v=d-(2+h));const y=[];for(let $=1;$<=d;$++)if($==1||$==d||$>=v&&$<=w){const T=l[$-1];y.push(T)}let c;const V=[];return y.forEach($=>{const T=parseInt($.childNodes[0].attributes["data-page"],10);if(c){const S=parseInt(c.childNodes[0].attributes["data-page"],10);if(T-S==2)V.push(l[S]);else if(T-S!=1){const O={nodeName:"LI",attributes:{class:`${f.paginationListItem} ${f.ellipsis} ${f.disabled}`},childNodes:[{nodeName:"A",attributes:{class:f.paginationListItemLink},childNodes:[{nodeName:"#text",data:u}]}]};V.push(O)}}V.push($),c=$}),V})(a,t,s,n)),o=o.concat(a),n.nextPrev){const l=e?s:t+1;o.push(K(l,n.nextText,n,{hidden:e}))}return n.firstLast&&o.push(K(s,n.lastText,n)),{nodeName:"UL",attributes:{class:n.classes.paginationList},childNodes:a.length>1?o:[]}};class Be{constructor(e,t={}){const s=typeof e=="string"?document.querySelector(e):e;s instanceof HTMLTableElement?this.dom=s:(this.dom=document.createElement("table"),s.appendChild(this.dom));const n={...se.diffDomOptions,...t.diffDomOptions},o={...se.labels,...t.labels},a={...se.classes,...t.classes};this.options={...se,...t,diffDomOptions:n,labels:o,classes:a},this._initialInnerHTML=this.options.destroyable?this.dom.innerHTML:"",this.options.tabIndex?this.dom.tabIndex=this.options.tabIndex:this.options.rowNavigation&&this.dom.tabIndex===-1&&(this.dom.tabIndex=0),this._listeners={onResize:()=>this._onResize()},this._dd=new Ye(this.options.diffDomOptions||{}),this.initialized=!1,this._events={},this._currentPage=0,this.onFirstPage=!0,this.hasHeadings=!1,this.hasRows=!1,this._searchQueries=[],this.init()}init(){if(this.initialized||this.dom.classList.contains(this.options.classes.table))return!1;this._virtualDOM=U(this.dom,this.options.diffDomOptions||{}),this._tableAttributes={...this._virtualDOM.attributes},this.rows=new Re(this),this.columns=new je(this),this.data=Ve(this.options.data,this.dom,this.columns.settings,this.options.type,this.options.format),this._render(),setTimeout(()=>{this.emit("datatable.init"),this.initialized=!0},10)}_render(){this.wrapperDOM=be("div",{class:`${this.options.classes.wrapper} ${this.options.classes.loading}`}),this.wrapperDOM.innerHTML=this.options.template(this.options,this.dom);const e=this.wrapperDOM.querySelector(`select.${this.options.classes.selector}`);e&&this.options.paging&&this.options.perPageSelect?this.options.perPageSelect.forEach(t=>{const[s,n]=Array.isArray(t)?[t[0],t[1]]:[String(t),t],o=n===this.options.perPage,a=new Option(s,String(n),o,o);e.appendChild(a)}):e&&e.parentElement.removeChild(e),this.containerDOM=this.wrapperDOM.querySelector(`.${this.options.classes.container}`),this._pagerDOMs=[],Array.from(this.wrapperDOM.querySelectorAll(`.${this.options.classes.pagination}`)).forEach(t=>{t instanceof HTMLElement&&(t.innerHTML=`<ul class="${this.options.classes.paginationList}"></ul>`,this._pagerDOMs.push(t.firstElementChild))}),this._virtualPagerDOM={nodeName:"UL",attributes:{class:this.options.classes.paginationList}},this._label=this.wrapperDOM.querySelector(`.${this.options.classes.info}`),this.dom.parentElement.replaceChild(this.wrapperDOM,this.dom),this.containerDOM.appendChild(this.dom),this._rect=this.dom.getBoundingClientRect(),this._fixHeight(),this.options.header||this.wrapperDOM.classList.add("no-header"),this.options.footer||this.wrapperDOM.classList.add("no-footer"),this.options.sortable&&this.wrapperDOM.classList.add("sortable"),this.options.searchable&&this.wrapperDOM.classList.add("searchable"),this.options.fixedHeight&&this.wrapperDOM.classList.add("fixed-height"),this.options.fixedColumns&&this.wrapperDOM.classList.add("fixed-columns"),this._bindEvents(),this.columns._state.sort&&this.columns.sort(this.columns._state.sort.column,this.columns._state.sort.dir,!0),this.update(!0)}_renderTable(e={}){let t=De(this._tableAttributes,this.data.headings,(this.options.paging||this._searchQueries.length||this.columns._state.filters.length)&&this._currentPage&&this.pages.length&&!e.noPaging?this.pages[this._currentPage-1]:this.data.data.map((n,o)=>({row:n,index:o})),this.columns.settings,this.columns._state,this.rows.cursor,this.options,e);if(this.options.tableRender){const n=this.options.tableRender(this.data,t,"main");n&&(t=n)}const s=this._dd.diff(this._virtualDOM,t);this._dd.apply(this.dom,s),this._virtualDOM=t}_renderPage(e=!1){this.hasRows&&this.totalPages?(this._currentPage>this.totalPages&&(this._currentPage=1),this._renderTable(),this.onFirstPage=this._currentPage===1,this.onLastPage=this._currentPage===this.lastPage):this.setMessage(this.options.labels.noRows);let t,s=0,n=0,o=0;if(this.totalPages&&(s=this._currentPage-1,n=s*this.options.perPage,o=n+this.pages[s].length,n+=1,t=this._searchQueries.length?this._searchData.length:this.data.data.length),this._label&&this.options.labels.info.length){const a=this.options.labels.info.replace("{start}",String(n)).replace("{end}",String(o)).replace("{page}",String(this._currentPage)).replace("{pages}",String(this.totalPages)).replace("{rows}",String(t));this._label.innerHTML=t?a:""}if(this._currentPage==1&&this._fixHeight(),this.options.rowNavigation&&this._currentPage&&(!this.rows.cursor||!this.pages[this._currentPage-1].find(a=>a.index===this.rows.cursor))){const a=this.pages[this._currentPage-1];a.length&&(e?this.rows.setCursor(a[a.length-1].index):this.rows.setCursor(a[0].index))}}_renderPagers(){if(!this.options.paging)return;let e=We(this.onFirstPage,this.onLastPage,this._currentPage,this.totalPages,this.options);if(this.options.pagerRender){const s=this.options.pagerRender([this.onFirstPage,this.onLastPage,this._currentPage,this.totalPages],e);s&&(e=s)}const t=this._dd.diff(this._virtualPagerDOM,e);this._pagerDOMs.forEach(s=>{this._dd.apply(s,t)}),this._virtualPagerDOM=e}_renderSeparateHeader(){const e=this.dom.parentElement;this.headerDOM||(this.headerDOM=document.createElement("div"),this._virtualHeaderDOM={nodeName:"DIV"}),e.parentElement.insertBefore(this.headerDOM,e);let t={nodeName:"TABLE",attributes:this._tableAttributes,childNodes:[{nodeName:"THEAD",childNodes:[fe(this.data.headings,this.columns.settings,this.columns._state,this.options,{unhideHeader:!0})]}]};if(t.attributes.class=t.attributes.class?`${t.attributes.class} ${this.options.classes.table}`:this.options.classes.table,this.options.tableRender){const a=this.options.tableRender(this.data,t,"header");a&&(t=a)}const s={nodeName:"DIV",attributes:{class:this.options.classes.headercontainer},childNodes:[t]},n=this._dd.diff(this._virtualHeaderDOM,s);this._dd.apply(this.headerDOM,n),this._virtualHeaderDOM=s;const o=this.headerDOM.firstElementChild.clientWidth-this.dom.clientWidth;if(o){const a=structuredClone(this._virtualHeaderDOM);a.attributes.style=`padding-right: ${o}px;`;const l=this._dd.diff(this._virtualHeaderDOM,a);this._dd.apply(this.headerDOM,l),this._virtualHeaderDOM=a}e.scrollHeight>e.clientHeight&&(e.style.overflowY="scroll")}_bindEvents(){if(this.options.perPageSelect){const e=this.wrapperDOM.querySelector(`select.${this.options.classes.selector}`);e&&e instanceof HTMLSelectElement&&e.addEventListener("change",()=>{this.options.perPage=parseInt(e.value,10),this.update(),this._fixHeight(),this.emit("datatable.perpage",this.options.perPage)},!1)}this.options.searchable&&this.wrapperDOM.addEventListener("input",e=>{const t=e.target;if(!(t instanceof HTMLInputElement&&t.matches(`.${this.options.classes.input}`)))return;e.preventDefault();const s=Array.from(this.wrapperDOM.querySelectorAll(`.${this.options.classes.input}`)).filter(n=>n.value.length).map(n=>n.dataset.columns?{term:n.value,columns:JSON.parse(n.dataset.columns)}:{term:n.value,columns:void 0});if(s.length===1){const n=s[0];this.search(n.term,n.columns)}else this.multiSearch(s)}),this.wrapperDOM.addEventListener("click",e=>{const t=e.target.closest("a");if(t){if(t.hasAttribute("data-page"))this.page(parseInt(t.getAttribute("data-page"),10)),e.preventDefault();else if(t.classList.contains(this.options.classes.sorter)){const s=Array.from(t.parentElement.parentElement.children).indexOf(t.parentElement),n=ve(s,this.columns.settings);this.columns.sort(n),e.preventDefault()}else if(t.classList.contains(this.options.classes.filter)){const s=Array.from(t.parentElement.parentElement.children).indexOf(t.parentElement),n=ve(s,this.columns.settings);this.columns.filter(n),e.preventDefault()}}},!1),this.options.rowNavigation?(this.dom.addEventListener("keydown",e=>{if(e.key==="ArrowUp"){let t;e.preventDefault(),e.stopPropagation(),this.pages[this._currentPage-1].find(s=>s.index===this.rows.cursor||(t=s,!1)),t?this.rows.setCursor(t.index):this.onFirstPage||this.page(this._currentPage-1,!0)}else if(e.key==="ArrowDown"){let t;e.preventDefault(),e.stopPropagation();const s=this.pages[this._currentPage-1].find(n=>!!t||(n.index===this.rows.cursor&&(t=!0),!1));s?this.rows.setCursor(s.index):this.onLastPage||this.page(this._currentPage+1)}else["Enter"," "].includes(e.key)&&this.emit("datatable.selectrow",this.rows.cursor,e)}),this.dom.addEventListener("mousedown",e=>{const t=e.target;if(t instanceof Element&&this.dom.matches(":focus")){const s=Array.from(this.dom.querySelectorAll("body tr")).find(n=>n.contains(t));s&&s instanceof HTMLElement&&this.emit("datatable.selectrow",parseInt(s.dataset.index,10),e)}})):this.dom.addEventListener("mousedown",e=>{const t=e.target;if(!(t instanceof Element))return;const s=Array.from(this.dom.querySelectorAll("body tr")).find(n=>n.contains(t));s&&s instanceof HTMLElement&&this.emit("datatable.selectrow",parseInt(s.dataset.index,10),e)}),window.addEventListener("resize",this._listeners.onResize)}_onResize(){this._rect=this.containerDOM.getBoundingClientRect(),this._rect.width&&this.update(!0)}destroy(){this.options.destroyable&&(this.dom.innerHTML=this._initialInnerHTML,this.dom.classList.remove(this.options.classes.table),this.wrapperDOM.parentElement&&this.wrapperDOM.parentElement.replaceChild(this.dom,this.wrapperDOM),this.initialized=!1,window.removeEventListener("resize",this._listeners.onResize))}update(e=!1){e&&(this.columns._measureWidths(),this.hasRows=!!this.data.data.length,this.hasHeadings=!!this.data.headings.length),this.wrapperDOM.classList.remove(this.options.classes.empty),this._paginate(),this._renderPage(),this._renderPagers(),this.options.scrollY.length&&this._renderSeparateHeader(),this.emit("datatable.update")}_paginate(){let e=this.data.data.map((t,s)=>({row:t,index:s}));return this._searchQueries.length&&(e=[],this._searchData.forEach(t=>e.push({index:t,row:this.data.data[t]}))),this.columns._state.filters.length&&this.columns._state.filters.forEach((t,s)=>{t&&(e=e.filter(n=>typeof t=="function"?t(n.row[s].data):(n.row[s].text??n.row[s].data)===t))}),this.options.paging&&this.options.perPage>0?this.pages=e.map((t,s)=>s%this.options.perPage==0?e.slice(s,s+this.options.perPage):null).filter(t=>t):this.pages=[e],this.totalPages=this.lastPage=this.pages.length,this._currentPage||(this._currentPage=1),this.totalPages}_fixHeight(){this.options.fixedHeight&&(this.containerDOM.style.height=null,this._rect=this.containerDOM.getBoundingClientRect(),this.containerDOM.style.height=`${this._rect.height}px`)}search(e,t){if(!e.length)return this._currentPage=1,this._searchQueries=[],this._searchData=[],this.update(),this.emit("datatable.search","",[]),this.wrapperDOM.classList.remove("search-results"),!1;this.multiSearch([{term:e,columns:t||void 0}]),this.emit("datatable.search",e,this._searchData)}multiSearch(e){if(!this.hasRows)return!1;if(this._currentPage=1,this._searchQueries=e,this._searchData=[],!(e=e.filter(s=>s.term.length)).length)return this.update(),this.emit("datatable.multisearch",e,this._searchData),this.wrapperDOM.classList.remove("search-results"),!1;const t=e.map(s=>this.columns.settings.map((n,o)=>{if(n.hidden||!n.searchable||s.columns&&!s.columns.includes(o))return!1;let a=s.term;const l=n.sensitivity||this.options.sensitivity;return["base","accent"].includes(l)&&(a=a.toLowerCase()),["base","case"].includes(l)&&(a=a.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"")),(n.ignorePunctuation||this.options.ignorePunctuation)&&(a=a.replace(/[.,/#!$%^&*;:{}=-_`~()]/g,"")),a}));this.data.data.forEach((s,n)=>{const o=s.map((a,l)=>{let r=(a.text||String(a.data)).trim();if(r.length){const d=this.columns.settings[l],g=d.sensitivity||this.options.sensitivity;["base","accent"].includes(g)&&(r=r.toLowerCase()),["base","case"].includes(g)&&(r=r.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"")),(d.ignorePunctuation||this.options.ignorePunctuation)&&(r=r.replace(/[.,/#!$%^&*;:{}=-_`~()]/g,""))}return r});t.every(a=>a.find((l,r)=>!!l&&(this.columns.settings[r].isSplitQueryWord?l.split(this.columns.settings[r].searchQuerySeparator):[l]).find(d=>o[r].includes(d.trim()))))&&this._searchData.push(n)}),this.wrapperDOM.classList.add("search-results"),this._searchData.length?this.update():(this.wrapperDOM.classList.remove("search-results"),this.setMessage(this.options.labels.noResults)),this.emit("datatable.multisearch",e,this._searchData)}page(e,t=!1){return e!==this._currentPage&&(isNaN(e)||(this._currentPage=e),!(e>this.pages.length||e<0)&&(this._renderPage(t),this._renderPagers(),void this.emit("datatable.page",e)))}insert(e){let t=[];if(Array.isArray(e)){const s=this.data.headings.map(n=>n.text??String(n.data));e.forEach((n,o)=>{const a=[];Object.entries(n).forEach(([l,r])=>{const d=s.indexOf(l);d>-1?a[d]=G(r,this.columns.settings[d]):this.hasHeadings||this.hasRows||o!==0||(a[s.length]=G(r,this.columns.settings[s.length]),s.push(l),this.data.headings.push(te(l)))}),t.push(a)})}else Oe(e)&&(!e.headings||this.hasHeadings||this.hasRows?e.data&&Array.isArray(e.data)&&(t=e.data.map(s=>s.map((n,o)=>G(n,this.columns.settings[o])))):this.data=Ve(e,void 0,this.columns.settings,this.options.type,this.options.format));t.length&&t.forEach(s=>this.data.data.push(s)),this.hasHeadings=!!this.data.headings.length,this.columns._state.sort&&this.columns.sort(this.columns._state.sort.column,this.columns._state.sort.dir,!0),this.update(!0)}refresh(){this.options.searchable&&(Array.from(this.wrapperDOM.querySelectorAll(`.${this.options.classes.input}`)).forEach(e=>{e.value=""}),this._searchQueries=[]),this._currentPage=1,this.onFirstPage=!0,this.update(!0),this.emit("datatable.refresh")}print(){const e=be("table");let t=De(this._tableAttributes,this.data.headings,this.data.data.map((o,a)=>({row:o,index:a})),this.columns.settings,this.columns._state,!1,this.options,{noColumnWidths:!0,unhideHeader:!0});if(this.options.tableRender){const o=this.options.tableRender(this.data,t,"print");o&&(t=o)}const s=this._dd.diff({nodeName:"TABLE"},t);this._dd.apply(e,s);const n=window.open();n.document.body.appendChild(e),n.print()}setMessage(e){const t=this.data.headings.filter((o,a)=>{var l;return!((l=this.columns.settings[a])!=null&&l.hidden)}).length||1;this.wrapperDOM.classList.add(this.options.classes.empty),this._label&&(this._label.innerHTML=""),this.totalPages=0,this._renderPagers();let s={nodeName:"TABLE",attributes:this._tableAttributes,childNodes:[{nodeName:"THEAD",childNodes:[fe(this.data.headings,this.columns.settings,this.columns._state,this.options,{})]},{nodeName:"TBODY",childNodes:[{nodeName:"TR",childNodes:[{nodeName:"TD",attributes:{class:this.options.classes.empty,colspan:String(t)},childNodes:[{nodeName:"#text",data:e}]}]}]}]};if(s.attributes.class=s.attributes.class?`${s.attributes.class} ${this.options.classes.table}`:this.options.classes.table,this.options.tableRender){const o=this.options.tableRender(this.data,s,"message");o&&(s=o)}const n=this._dd.diff(this._virtualDOM,s);this._dd.apply(this.dom,n),this._virtualDOM=s}on(e,t){this._events[e]=this._events[e]||[],this._events[e].push(t)}off(e,t){e in this._events&&this._events[e].splice(this._events[e].indexOf(t),1)}emit(e,...t){if(e in this._events)for(let s=0;s<this._events[e].length;s++)this._events[e][s](...t)}}class qe{constructor(e,t){if(this.options={labels:{perPage:""},prevText:"Previous",nextText:"Next",template:(s,n)=>`
          <div class='${s.classes.top}'>
            ${s.searchable?`<div class='${s.classes.search}'>
                  <label class="text-sm font-medium text-slate-500 dark:text-slate-400" for="">Search:</label>
                  <input class='${s.classes.input} input bg-white dark:bg-slate-800' placeholder='${s.labels.placeholder}' type='search' title='${s.labels.searchTitle}'${n.id?` aria-controls="${n.id}"`:""}>
              </div>`:""}

            ${s.paging&&s.perPageSelect?`<div class='${s.classes.dropdown}'>
                <label class="text-sm font-medium text-slate-500 dark:text-slate-400" for="">Entries:</label>
                <select class='${s.classes.selector} select bg-white dark:bg-slate-800'></select>
            </div>`:""}
          </div>

          <div class='${s.classes.container}'${s.scrollY.length?`style='height: ${s.scrollY}; overflow-Y: auto;'`:""}></div>

          <div class='${s.classes.bottom}'>
            ${s.paging?`<div class='${s.classes.info}'></div>`:""}
            <nav class='${s.classes.pagination}'></nav>
          </div>
        `,...t},this.target=null,typeof e=="string"&&(this.target=document.querySelector(e)),e instanceof HTMLElement&&(this.target=e),!this.target)throw new Error("No target element found");return this.render()}render(){return new Be(this.target,this.options)}}export{qe as D};
